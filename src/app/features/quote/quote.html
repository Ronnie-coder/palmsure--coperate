<main class="quote-page section-padding">
  <!-- Brand Gradient Background -->
  <div class="page-background-gradient"></div>

  <div class="container relative-z">
    <div class="quote-tool-wrapper">

      <!-- HEADER -->
      <header class="quote-header">
        <h1>Get Your Personalized Quote</h1>

        <!-- Progress Bar (Steps 1-3 only) -->
        <div class="progress-container" *ngIf="currentStep < 4">
          <div class="step-indicator" [class.active]="currentStep >= 1">1</div>
          <div class="step-line" [class.active]="currentStep >= 2"></div>
          <div class="step-indicator" [class.active]="currentStep >= 2">2</div>
          <div class="step-line" [class.active]="currentStep >= 3"></div>
          <div class="step-indicator" [class.active]="currentStep >= 3">3</div>
        </div>

        <p class="header-desc" *ngIf="currentStep === 1">Step 1: What can we help you insure?</p>
        <p class="header-desc" *ngIf="currentStep === 2">Step 2: Tell us about yourself</p>
        <p class="header-desc" *ngIf="currentStep === 3">Step 3: Specific Details</p>
        <p class="header-desc" *ngIf="currentStep === 4">Thank you for your submission!</p>
      </header>

      <!-- CONTENT SWITCHER -->
      <div [ngSwitch]="currentStep">

        <!-- STEP 1: TYPE SELECTION -->
        <div *ngSwitchCase="1" class="quote-step-content">
          <div class="selection-grid">
            <div *ngFor="let type of insuranceTypes" class="selection-card" tabindex="0"
                 [class.selected]="type.id === selectedInsuranceType"
                 (click)="selectInsuranceType(type.id)">
              <span class="material-symbols-outlined card-icon">{{ type.icon }}</span>
              <h3>{{ type.name }}</h3>
              <p>{{ type.description }}</p>
            </div>
          </div>
        </div>

        <!-- STEP 2: PERSONAL INFO -->
        <div *ngSwitchCase="2" class="quote-step-content">
          <form [formGroup]="personalDetailsForm" novalidate>
            <div class="form-grid">
              <div class="form-group">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" formControlName="firstName" [class.is-invalid]="p['firstName'].invalid && p['firstName'].touched">
                <div *ngIf="p['firstName'].invalid && p['firstName'].touched" class="validation-message">Required.</div>
              </div>

              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" formControlName="lastName" [class.is-invalid]="p['lastName'].invalid && p['lastName'].touched">
                <div *ngIf="p['lastName'].invalid && p['lastName'].touched" class="validation-message">Required.</div>
              </div>

              <div class="form-group full-width">
                <label for="email">Email Address</label>
                <input type="email" id="email" formControlName="email" [class.is-invalid]="p['email'].invalid && p['email'].touched">
                <div *ngIf="p['email'].touched && p['email'].errors" class="validation-message">Valid email required.</div>
              </div>

              <div class="form-group full-width">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" formControlName="phone" [class.is-invalid]="p['phone'].invalid && p['phone'].touched">
                <div *ngIf="p['phone'].invalid && p['phone'].touched" class="validation-message">Phone number required.</div>
              </div>
            </div>
          </form>
        </div>

        <!-- STEP 3: SPECIFICS -->
        <div *ngSwitchCase="3" class="quote-step-content">
          <div [ngSwitch]="selectedInsuranceType">

            <!-- Property Form -->
            <form *ngSwitchCase="'property'" [formGroup]="propertyDetailsForm" novalidate>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label for="propertyAddress">Property Address</label>
                  <input type="text" id="propertyAddress" formControlName="propertyAddress" [class.is-invalid]="prop['propertyAddress'].invalid && prop['propertyAddress'].touched">
                </div>
                <div class="form-group full-width">
                  <label for="propertyValue">Estimated Value (R)</label>
                  <input type="number" id="propertyValue" formControlName="propertyValue" [class.is-invalid]="prop['propertyValue'].invalid && prop['propertyValue'].touched">
                </div>
              </div>
            </form>

            <!-- Vehicle Form -->
            <form *ngSwitchCase="'vehicle'" [formGroup]="vehicleDetailsForm" novalidate>
              <div class="form-grid">
                <div class="form-group">
                  <label for="vehicleMake">Make</label>
                  <input type="text" id="vehicleMake" formControlName="vehicleMake" [class.is-invalid]="veh['vehicleMake'].invalid && veh['vehicleMake'].touched">
                </div>
                <div class="form-group">
                  <label for="vehicleModel">Model</label>
                  <input type="text" id="vehicleModel" formControlName="vehicleModel" [class.is-invalid]="veh['vehicleModel'].invalid && veh['vehicleModel'].touched">
                </div>
                <div class="form-group full-width">
                  <label for="vehicleYear">Year</label>
                  <input type="number" id="vehicleYear" formControlName="vehicleYear" [class.is-invalid]="veh['vehicleYear'].invalid && veh['vehicleYear'].touched">
                </div>
              </div>
            </form>

            <!-- Business Form -->
            <form *ngSwitchCase="'business'" [formGroup]="businessDetailsForm" novalidate>
              <div class="form-grid">
                <div class="form-group">
                  <label for="businessName">Business Name</label>
                  <input type="text" id="businessName" formControlName="businessName" [class.is-invalid]="biz['businessName'].invalid && biz['businessName'].touched">
                </div>
                <div class="form-group">
                  <label for="industry">Industry</label>
                  <input type="text" id="industry" formControlName="industry" [class.is-invalid]="biz['industry'].invalid && biz['industry'].touched">
                </div>
                <div class="form-group full-width">
                  <label for="numEmployees">Number of Employees</label>
                  <input type="number" id="numEmployees" formControlName="numEmployees" [class.is-invalid]="biz['numEmployees'].invalid && biz['numEmployees'].touched">
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- STEP 4: SUCCESS -->
        <div *ngSwitchCase="4" class="quote-step-content success-message">
          <span class="material-symbols-outlined success-icon">check_circle</span>
          <h3>Request Received!</h3>
          <p>One of our expert brokers will review your information and contact you shortly. We appreciate your interest in Palmsure Insurance.</p>
          <a routerLink="/" class="btn btn-secondary">Return to Homepage</a>
        </div>
      </div>

      <!-- FOOTER ACTIONS -->
      <footer class="quote-footer" *ngIf="currentStep < 4">
        <button *ngIf="currentStep > 1" type="button" class="btn btn-secondary" (click)="goToPreviousStep()">Back</button>

        <div class="spacer" style="flex: 1"></div>

        <button *ngIf="currentStep < 3" class="btn btn-primary"
                [disabled]="(currentStep === 1 && !selectedInsuranceType) || (currentStep === 2 && personalDetailsForm.invalid)"
                (click)="goToNextStep()">
          Next Step
        </button>

        <button *ngIf="currentStep === 3" type="button" class="btn btn-primary" (click)="submitQuote()">
          Get My Quote
        </button>
      </footer>
    </div>
  </div>
</main>
